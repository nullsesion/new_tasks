<%= javascript_include_tag "tinycon", :plugin => 'new_tasks' %>
<% if User.current.logged? %>
<script type="text/javascript" >

 Tinycon.setOptions({
     width: 7,
     height: 10,
     font: '10px arial',
     colour: '#ffffff',
     background: '#009A00',
     fallback: true

  });
function getRandomArbitary(min, max){
	 return Math.random() * (max - min) + min;
}

$(function(){
	setInterval(function(){
		$('#ajax-indicator').unbind('ajaxSend')
		$('#ajax-indicator').unbind('ajaxStop')
		$.ajax({
		  type: "GET",
		  url:  "/tj?rnd=" + getRandomArbitary(10000, 9999999),
		  dataType: "json",
		  success: function(msg){
		     if (msg.length > 0){
		       Tinycon.setBubble(msg.length);
		     }else{
		       Tinycon.setBubble("");
		     }

		     setupAjaxIndicator();
		  },
	        });
	
	}, 2000)
});

</script>
<% end %>
